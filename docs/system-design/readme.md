# 系统设计

## 为什么要写设计文档？

设计文档（也被称为技术手册）是对你计划如何解决问题的描述。

设计文档是确保正确完成工作最有用的工具。**设计文档是通过强迫你思考完整的设计流程并且从他人处收集反馈的方式来使你的工作更有效率。**人们经常认为设计文档的目的是为了以后教会他人了解系统或者服务。虽然这些可能是有益的副作用，但他们本身并不是目标。

通常来说，如果你的项目需要花费一个工程师一个月以上，那就应该写设计文档。但不要就此止步 — 许多更小型的项目也可以从小型的设计文档中受益。

## 设计文档应该包含什么内容？

设计文档描述了问题的解决方法。既然每个问题的性质都不一样，自然就会希望你的设计文档结构不同。

### 标题和人员

设计文档的标题，作者，审查人员以及最新更新时间。

### 概述

一个高度的总结，公司的每个工程师都应该能看懂，并且以此来决定是否阅读剩下的内容。

此部分最多应有 3 个段落。

### 背景

描述下手头的问题，为什么要做这个项目，人们需要知道哪些内容来评估这个项目，它是如何融入技术战略、产品战略或者团队季度目标的。

### 目标与非目标

目标章节应该有：

描述用户驱动对项目的影响 - 你的用户可能是另外一个工程师团队或者甚至是另外一个技术系统

制定如何使用指标来衡量成功与否 - 如果你能可视化指标进度将会非常加分

非目标同样的重要，讲清楚那些你讲不会解决的问题，这样大家就能达成一致。

### 里程碑

一个可衡量的检查点列表，这样你的 PM 或者 Leader 就能大致知道项目的不同部分何时完成。如果项目超过一月以上，我推荐你把项目分解成以面向用户为主的里程碑。

使用像日历（译者：企业微信的日历就可以）这种工具，这样你就可以考虑到不相关的任务延迟、休假、会议等。它应该看起来像这样：

- 开始日期：2018.06.07
- 里程碑 1 新系统的 MVP 可运行暗黑模式：2018.06.28
- 里程碑 2 下线旧系统：2018.07.04
- 结束日期：添加特性 X，Y，Z 到新系统：2018.07.14

如果其中一些里程碑的预计时间发生变化，则在此增加一个 [更新] 小节，以便利益相关方可以很容易的看到最新的估时。

### 现有方案

除了描述当前的实现外，你还应该通过一个高层次的示例流程来说明用户如何与这个系统交互或者数据如何流经这个系统。

一个需求描述可以很好的框定这一点。请记住你的系统可能有不同类型的用户需要不同类型的用例。

### 提议方案

有些人称之为技术架构部分。还是那句话，试着通过一个需求描述来具体化它。可随意包含子章节和各种图表。

先提供一个大框架，然后再填充细节。要达到这样一种境界，写好它，然后你就能安心出去度个假，只要团队里的另一个工程师看了之后，按照你描述的方案实施就可以了。

### 替代方案

在想出上述解决方案时，你还考虑了什么？替代方案的优缺点是什么？你是否考虑过购买第三方的解决方案 - 或者使用开源的解决方案 - 来解决这个问题，而不是自己建立一个解决方案？

- 测试，监控和报警

  我很喜欢加上这部分内容，因为人们往往把这部分当作是事后诸葛亮，或者是一并跳过。但当事情搞砸时候这部分的缺失总是会反咬他们一口，并且他们不知道发生了什么，也不知道为什么发生。

- 跨团队的影响

  这将如何增加实时可用性和开发运营的负担？这将会花多少钱？会不会造成潜在的系统回滚风险？会不会暴露任何安全漏洞？有哪些负面的后果和副作用？支持团队可能会如何与客户交流此内容？

- 开放问题

  任何你不清楚的问题，有争议的决定，希望读者们能给予权衡，对未来工作的建议等等都可以写在这里。这个部分有一个风趣的名字，叫“已知的未知数”。

- 细节范围和时间线

  此章节大部分情况下会被开发此项目的工程师，他们的领导或者经理阅读。因此这个章节被放到文档的末尾。

  从本质上讲，这是对你计划如何以及何时执行项目的每个部分的分解。准确地确定范围有很多内容，所以你可以阅读本篇来了解更多关于范围确定的内容。

  我也倾向于把设计文档的这一部分当作一个正在进行的项目任务跟踪器，所以每当我的细节内容预估发生变化时，我就会更新这部分内容。但这更多的是个人的偏好。

参考

- https://mp.weixin.qq.com/s/EUAN-w14moJiQ0oVUTCtgQ

## 问题

- 在传统的瀑布模型中，编码是在详细设计之后的。
- 当前的实际开发经验，着手编码前难以进行非常详细的设计，多数是开发结束后才补到文档里的。
- 那么在实际的企业开发里，详细设计是在编码前就完成了吗？编码之前真的能够做到那么详细的设计吗？

实际上，系统设计，概要设计，详细设计，都是必须的

1. 系统设计，或者构架设计：是定义产品的大体目标，核心需求，发展策略的。
2. 概要设计：定义软件的分块，关键接口的属性，各种质量属性（可测试性，可调试性，可服务性，可靠性，安全性，可制造性等等）的设计策略。
3. 详细设计：分维度决定在编码流程阶段不可能考量的独立自恰逻辑。

说一下概要设计是怎么做的，目前已经模板化了：

1. 明确要做什么？产品需求分析（做哪些功能？做成什么样？）、技术需求分析（识别出产品功能涉及到的技术点、技术债务改善）；
2. 做成什么样？技术指标和指标项（性能指标：内存泄露、流畅度、功耗、启动速度；业务指标：准确率、平均耗时等）
3. 整体实现方案：技术框架（分层、分模块，重点是解耦）、核心功能流程图（围绕新功能和技术重难点，梳理流程，方便理清技术的复杂度）
4. 需要哪些领域配合？（商务合作、内容资源、后台接口、其它APP等）；各领域的交付件是什么？（通常都是接口）
5. 项目风险和应对方案，预计有什么问题，有哪些方法可以规避或者减小对项目的影响？
6. 项目排期：明确各领域的交付时间，风险往往是因为变更或者跨团队配合导致的


我们如何评估一个设计文档的成功？

我的同事 Kent Rakip 有一个好的答案：如果工作的 ROI 正确，一份设计文档就是成功的。这意味着一份成功的设计文档可能会导致这样的结果：

- 你要花费 5 天编写设计文档，这迫使你完整思考技术架构的不同部分
- 你从审查人那里得到的反馈是， X 是建议架构中风险最大的部分
- 你决定先实施 X ，以降低项目风险
- 3 天后，你发现 X 要么是不可能的，要么是远比你原来想象的要困难得多
- 你决定停止这个项目的工作，而优先考虑其他工作

在本文开头，我们说过，设计文档的目标是确保完成正确的工作。在上面的例子中，多亏了这个设计文档，你没有浪费可能几个月的时间，却在后来中止了这个项目，而是只花了 8 天时间。在我看来，这是一个很成功的结果。

参考：

- https://www.zoo.team/article/web-docsify
- https://zhuanlan.zhihu.com/p/420081330
- https://cloud.tencent.com/developer/article/1879546
- https://www.zhihu.com/question/300407894
- https://mp.weixin.qq.com/s/EUAN-w14moJiQ0oVUTCtgQ
